<div class="shop">
  <header>
    <h1>BOLTAC'S TRADING POST</h1>
  </header>

  <main>
    @if (currentView() === 'main') {
      <div class="main-view">
        <app-menu
          [items]="menuItems"
          (select)="handleMenuSelect($event)"
        />
      </div>
    }

    @if (currentView() === 'buy') {
      <div class="placeholder-view">
        <h2>BUY ITEMS</h2>
        <p class="placeholder-text">
          Item purchasing will be implemented in Phase 5.
        </p>
        <button class="cancel-btn" (click)="cancelView()">(ESC) Back</button>
      </div>
    }

    @if (currentView() === 'sell') {
      <div class="sell-view">
        <h2>SELL ITEMS</h2>

        @if (showSellConfirmation()) {
          <div class="confirmation-dialog">
            @if (getPendingSellItem(); as item) {
              <p>Sell {{ item.name }} for {{ getSellPrice(item) }} gold?</p>
              <div class="confirmation-actions">
                <button class="confirm-btn" (click)="confirmSell()">(Y) Yes</button>
                <button class="cancel-btn" (click)="cancelSell()">(N) No</button>
              </div>
            }
          </div>
        } @else {
          @if (selectedCharacter(); as character) {
            @if (getSellableItems().length > 0) {
              <div class="item-list">
                @for (item of getSellableItems(); track item.id) {
                  <div class="item-row">
                    <div class="item-info">
                      <span class="item-name">{{ item.name }}</span>
                      @if (item.equipped) {
                        <span class="equipped-badge">(Equipped)</span>
                      }
                    </div>
                    <div class="item-price">
                      <span class="sell-price">Sell: {{ getSellPrice(item) }} gold</span>
                      <button
                        class="sell-btn"
                        (click)="initiateSell(item.id)"
                        [disabled]="getSellPrice(item) === 0"
                      >
                        (S) Sell
                      </button>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <p class="empty-message">No items to sell</p>
            }

            <div class="party-gold">
              <strong>Party Gold:</strong> {{ gameState.party().gold || 0 }}
            </div>
          } @else {
            <p class="error-message">No character selected</p>
          }

          <button class="cancel-btn" (click)="cancelView()">(ESC) Back</button>
        }
      </div>
    }

    @if (currentView() === 'identify') {
      <div class="placeholder-view">
        <h2>IDENTIFY ITEMS</h2>
        <p class="placeholder-text">
          Item identification will be implemented in Phase 5.
        </p>
        <button class="cancel-btn" (click)="cancelView()">(ESC) Back</button>
      </div>
    }
  </main>
</div>
